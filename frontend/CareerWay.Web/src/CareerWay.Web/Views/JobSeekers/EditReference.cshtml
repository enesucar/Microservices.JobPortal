@using CareerWay.Web.Models.JobSeekers

@{
    var positionOptions = string.Join("",
       ((List<SelectListItem>)ViewBag.Positions)
           .Select(p => $"<option value='{p.Value}'>{p.Text}</option>")
   );
}

@model CreateJobSeekerReferenceViewModel

<div class="dashboard-wrap bg-light">
    <div class="dashboard-content container px-3">
        <ul class="nav nav-tabs" role="tablist">
            <li class="nav-item" role="presentation">
                <a href="/personal-info" class="nav-link" role="tab" aria-selected="true">Kişisel Bilgiler</a>
            </li>
            <li class="nav-item" role="presentation">
                <a href="/oz-gecmis-duzenle/okul-bilgilerim" class="nav-link" role="tab" aria-selected="false">Eğitim</a>
            </li>
            <li class="nav-item" role="presentation">
                <a href="/oz-gecmis-duzenle/referanslarim" class="nav-link active" role="tab" aria-selected="false">Referanslarım</a>
            </li>
            <li class="nav-item" role="presentation">
                <a href="/skills" class="nav-link" role="tab" aria-selected="false">Yetenekler</a>
            </li>
            <li class="nav-item" role="presentation">
                <a href="/preview" class="nav-link" role="tab" aria-selected="false">Önizleme</a>
            </li>
        </ul>

        <!-- Sekme içerikleri -->
        <div class="tab-content" id="resumeTabContent">
            <!-- Education Details -->
            <form class="row" asp-action="EditReference" asp-controller="JobSeekers">

                <div class="tab-pane fade show active" id="education" role="tabpanel" aria-labelledby="education-tab">
                    <div class="_dashboard_content bg-white rounded mb-4">
                        <div class="_dashboard_content_body py-3 px-3" id="references-container">
                            @for (int i = 0; i < Model.References.Count; i++)
                            {
                                <div class="col-xl-12 col-lg-12">
                                    <div class="gray rounded p-3 mb-3 position-relative">
                                        <button type="button" class="aps-clone remove-reference"><i class="fas fa-times"></i></button>
                                        <div class="form-group">
                                            <label class="text-dark ft-medium">Full Name</label>
                                            <input type="text" class="form-control rounded" name="References[@i].FullName" value="@Model.References[i].FullName" placeholder="Full Name" />
                                        </div>
                                        <div class="form-group">
                                            <label class="text-dark ft-medium">Position</label>
                                            @Html.DropDownListFor(m => m.References[i].PositionId, (List<SelectListItem>)ViewBag.Positions, "Select Position", new { @class = "form-control rounded" })
                                        </div>
                                        <div class="form-row row">
                                            <div class="col-6">
                                                <div class="form-group">
                                                    <label class="text-dark ft-medium">Phone Number</label>
                                                    <input type="text" class="form-control rounded" name="References[@i].PhoneNumber" value="@Model.References[i].PhoneNumber" placeholder="Phone Number" />
                                                </div>

                                            </div>
                                            <div class="col-6">
                                                <div class="form-group">
                                                    <label class="text-dark ft-medium">Company Name</label>
                                                    <input type="text" class="form-control rounded" name="References[@i].CompanyName" value="@Model.References[i].CompanyName" placeholder="Company Name" />
                                                </div>
                                            </div>
                                        </div>
                                    </div>


                                </div>
                            }
                            <div class="col-xl-12 col-lg-12">
                                <div class="form-group">
                                    <button type="button" class="btn gray ft-medium apply-btn fs-sm rounded" onclick="addReference()">
                                        <i class="fas fa-plus me-1"></i> Referans Ekle
                                    </button>
                                </div>
                            </div>

                        </div>
                    </div>
                </div>

                <!-- Save & Preview Button -->
                <div class="row mt-3">
                    <div class="col-lg-12 col-md-12">
                        <button type="submit" class="btn btn-md ft-medium text-light rounded theme-bg">Save & Preview</button>
                    </div>
                </div>
            </form>

        </div>

        <!-- footer -->
        <div class="row mt-4">
            <div class="col-md-12">
                <div class="py-3">© 2023 Workplex. Designed By ThemezHub.</div>
            </div>
        </div>

    </div>
</div>

<script>
        let index = @Model.References.Count;
        const positionOptions = `@Html.Raw(positionOptions)`;
        function addReference() {
        const container = document.getElementById("references-container");

         const html = `
                <div class="gray rounded p-3 mb-3 position-relative reference-block" data-index="${index}">
                    <button type="button" class="aps-clone remove-reference">
                        <i class="fas fa-times"></i>
                    </button>

                    <div class="form-group">
                        <label>Full Name</label>
                        <input type="text" class="form-control rounded" name="References[${index}].FullName" placeholder="Full Name" />
                    </div>

                    <div class="form-group">
                        <label class="text-dark ft-medium">Position</label>
                        <select class="form-control rounded" name="References[${index}].PositionId">
                            ${positionOptions}
                        </select>
                    </div>


                    <div class="form-group">
                        <label>Phone Number</label>
                        <input type="text" class="form-control rounded" name="References[${index}].PhoneNumber" placeholder="Phone Number" />
                    </div>

                    <div class="form-group">
                        <label>Company Name</label>
                        <input type="text" class="form-control rounded" name="References[${index}].CompanyName" placeholder="Company Name" />
                    </div>
                </div>
            `;

        container.insertAdjacentHTML("beforeend", html);
        index++;
    }

        document.addEventListener("click", function (e) {
        const btn = e.target.closest(".remove-reference");
        if (btn) {
            e.preventDefault();
            const block = btn.closest(".reference-block");
            if (block) block.remove();
        }
    });
</script> 